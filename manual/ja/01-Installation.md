# インストール

以下の章ではContaoのインストールと更新の方法を説明しています。Contaoのインストールツールの使い方、FTPで既存のインストールと合わせる方法、セーフモード対処の設定の方法、Contaoのために稼働中のサーバーを設定する方法について学べます。

## Contaoのインストール

まず始めに、[最新のContaoのアーカイブ][1]をダウンロードして使用しているコンピューター上で展開してください。展開したファイルを(XAMPPの場合に)コンピューター上の`htdocs`に移動するか、FTPプログラム([WinSCP][2]の使用を推奨)でサーバーにアップロードしてください。サーバーの設定に依存しますが、公開フォルダーは`htpdocs`、`httpdocs`、`html`、`public_html`といった名前となっている場合が多いでしょう。

サーバーにSSHでアクセスできるなら、以下のコマンドでアーカイブのダウンロードして展開できます:


``` {.bash}
curl -L http://download.contao.org | tar -xzp
```


### Contaoのインストールツール

Contaoのインストールツールを開始するには、ContaoをインストールするURLに単純に`/contao/install.php`を加えてアクセスしてください。インストールツールは総当たりの攻撃に対する防護をしていて、連続して誤ったパスワードを3回入力するとロックします。ロックを解除するには、テキストエディターで`system/config/localconfig.php`を開いて、以下の行を見つけて`0`に値を設定します。

``` {.php}
$GLOBALS['TL_CONFIG']['installCount'] = 0; // これで自動的なロックを削除
```


#### データベースに接続

サーバーの(例えば"Plesk"や"cPanel"といった)管理パネルにログインして、Contao用の新しいデータベースを作成してください。そして、Contaoのインストールツールに認証情報を入力してください。Contaoの文字セットの初期値の`UTF-8`は、MySQLでは`UTF8`と書くことに注意してください!


#### データベースのテーブルの更新

データベースに接続するとContaoは自動的にテーブルを確認して、最新の状態でない場合は推奨する変更のリストを表示します。この推奨する内容は注意深く読むようにしてください。なぜなら、Contaoはそれ自身のテーブルだけを知っていて、データベースを共有している他のアプリケーションのテーブルを最終的に削除しようとするからです。変更を確認して「データベースを更新」のボタンをクリックしてください。


#### テンプレートのインポート

テンプレートは設定済みのウェブサイトで、例となるページとContaoのコアモジュールとコンテント要素の書式を整形する異なるスタイルシートからなります。

バージョン3.2.11から、ダウンロードしたパッケージは見本のウェブページを夫君でいません。使用しているバージョンに応じて、新しい[*Contaoの公式なデモ*][12]か古い[*Music Academy*][13]を機能拡張としてインストールしてください。

**デモのインストールの方法:**

1. 新しくContaoを管理者ユーザーを作成してインストール
2. 管理者ユーザーでバックエンドにログイン
3. 適合する拡張を[機能拡張リポジトリを使用][14]でインストール
4. バックエンドからログアウト
5. 再度インストールツールを開く

テンプレートをインポートするには、ドロップダウンメニューから項目を選択して、「テンプレートをインポート」をクリックしてください。

**テンプレートをインポートするとき、既存のデータを置き換えます!**


#### 管理者ユーザーの作成

テンプレートをインポートしなかった場合は、Contaoにログインする管理者ユーザーを作成しなければなりません。このアカウント作成すると、インストールの処理は完了です。右下の隅にあるリンクから管理領域に移動できます。サンプルのテンプレートをインポートした場合は"k.jones"というユーザーと"kevinjones"というパスワードでログインできます。


### Contaoのデモのインストール

*デモのインストールの方法*の節[*テンプレートのインポート*][15]を参照してください。


### 検索エンジンが扱いやすいURLの使用

Apacheをサーバーとして動作させていてmod_rewriteの使用が可能な場合は、静的なHTMLドキュメントのように見える、検索エンジンが扱いやすいURLをContaoが生成させることができます。
Contaoのディレクトリにある`.htaccess.default`というファイルには、いくつかの書き換えルールの初期設定が含まれています。
このファイルを`.htaccess`と名前を変更すると、これをApacheサーバーは処理するようになりますので、バックエンドにログインしてシステムの設定を変更してください。
「フロントエンドの構成」のセクションにある「URLの書き換え」を選択状態にして、変更を保存してください。これでContaoは`index.php?id=12`の代わりに`home.html`といったURLを生成するようになります。


## セーフモード対処の使用

Contaoをインストールツールでインストールしようとすると、ローカルの構成ファイルに書き込めないという警告が表示されるかもしれません。

![](images/localconfig-not-writable.jpg?raw=true)


### ファイルの権限の問題

「セーフモード対処」という用語は実際には語弊があります、というのもPHPの`safe_mode`によって起きる問題と暗に示すからです。しかし、実際はファイルへの不十分な権限によって発生して、`safe_mode`が無効でも起きる場合があります。代わりに「ファイルアクセス権限対処」とでも呼ぶべきでしょう。ApacheのモジュールによるPHPは一般に`wwwrun`、`www-data`、`nobody`といったユーザーで動作するのに対して、FTPでアップロードしたファイルはあなた(`web4`や`ab5678`といったユーザー)が所有者となります。このような状況だと、サーバーはこれらのファイルにPHPスクリプトからのアクセスを許可しません。


#### ファイルの操作にFTPを使用

この権限の問題に対処するために、ContaoはFTP接続を行ってファイルとフォルダーを変更します。このために必要なのはFTPのログインの詳細を入力するだけです。FTPのルートディレクトリからContaoのフォルダー(例えば`html/`、`public_html/`、`httpdocs/`)への相対パスを入力するときは特に注意してください。

PHPが直接アクセスするため、いくつかのディレクトリはさらに書き込みの権限が必要です:

* `assets/images`
* `assets/images/*`
* `system/logs`
* `system/tmp`

インストールツールは権限(CHMOD 777)を自動的に設定するので、通常は手作業で調整する必要はありません。万が一必要な場合は、**上に示した3つのディレクトリだけ調整して**ください。例え入門書やContaoのフォーラムにどのように書かれていたとしても!


## 手作業による更新

インストールしているContaoを手作業で更新するときは、Contaoのダウンロードしたアーカイブ全体をサーバーにアップロードする(ファイルをの置き換え)か、最後の更新から変更されたファイルだけをアップロードする(ファイルの同期)か、どちらかで行えます。いずれの場合でも、エラーや誤って上書きした場合のため、以下のファイルとフォルダーを常にバックアップすべきです。

* `files/*`
* `system/config/dcaconfig.php`
* `system/config/initconfig.php`
* `system/config/langconfig.php`
* `system/config/localconfig.php`
* `templates/*`

これでローカルの設定、カスタマイズしたテンプレート、あなたのファイルをバックアップしたことになります。


### ファイルの置き換え

インストールしているContaoのファイルの置き換えは極めて単純です。Contaoのダウンロードしたアーカイブを単にサーバー上で展開するか、ローカルのコンピューター上で展開してFTPクライアントでファイルをアップロードしてください。そしてバックアップしたファイルを復元して、前のContaoのバージョンの残りのファイルがあれば削除してください。

**注意**: 第三者の機能拡張をインストールしている場合、それらのバックアップと復元も忘れずに行うようにするか、完全に上書きしないようにしてください。そうしないと、モジュールを再インストールしなければならなくなり、機能拡張によってはデータを結果的に失うこともあるからです!


### ファイルの同期

インストールしているContaoの同期をするには、[Unixのdiffユーティリティ][3]かFTPプログラムのどちらかを使用できます。Unixのユーティリティーは一般にサーバーの管理者だけが使用するため、ここでは説明しません。ファイルをFTPで同期するには、WinSCPを実行してサーバーに接続してください。上記で述べたファイルをバックアップしてから、Contaoのディレクトリを指定して、「ファイルの同期(Synchronize files)」のボタンをクリックしてください。

![](images/synchronization-options.jpg?raw=true)

オプションを注意深く見直してから「変更のプレビュー("Preview changes")」を選択すると、更新されるファイルを確認できます。それから、それぞれのファイルをプレビューウィンドウで確認し、削除すると印のついたファイルは二重にチェックしてください!  "OK"をクリックすると同期の処理を開始します。

![](images/synchronization-confirmation.jpg?raw=true)


### データベースの更新

Contaoのファイルを更新した後は、データベースも更新しなければなりません。幸い、Contaoのインストールツールが殆どの作業を行ってくれます。Contaoのインストールツールを開いてパスワードを入力して、ページをデータベースのセクションまでスクロールして、変更内容を確認してください。


## ライブアップデートサービス


Contaoライブアップデートサービスは商用のContaoの追加機能で、Contaoの創始者で中心的な開発者であるLeo Feyer氏の[iNet Robots社][4]が提供しています。ライブアップデートサービスを利用すると、バックエンドで数回のクリックでインストールしているContaoを更新でき、ContaoのアーカイブをダウンロードやFTPプログラムでファイルの置き換えや同期を行う必要もありません。

[Sign up for a Live Update ID][5]

ライブアップデートサービスには以下の特徴があります:

* 任意のバージョンのContaoへアップグレードとダウングレード
* アップデートの前の自動的なデータベースのバックアップ
* インストールしているContaoの個別の検証と完成
* カスタマイズしたテンプレートと元のファイルの比較


### バージョンの選択

![](images/live-update-1.jpg?raw=true)


### テンプレートの違い

![](images/live-update-2.jpg?raw=true)


### トラブルシューティング

ライブアップデートのすべての問題の99%は、誤ったファイルの権限によります。Contaoはファイルとフォルダーを管理するために書き込み権限を必要としますので、ライブアップデートが適切に動作しない場合はサーバーの設定を確認し、**このユーザーガイドで説明しているように**セーフモード対処を設定していることを確認してください。


#### サポートの受け方

ライブアップデートIDの起動やアップデートのアーカイブの受信に問題がある場合は、[iNet Robots社][6]に連絡してください。セーフモード対処やContaoの使用に問題がある場合は、[サポートのページ][7]にあるサポートの選択肢を選択してください。


## インストールしているContaoの移設

インストールしているContaoをローカルのサーバーから稼働中のサーバーに移設するのは、新しいContaoのバージョンをインストールするのに比べてあまり違いはありません。違いはダウンロードしたContaoのアーカイブの代わりにローカルにインストールしているファイルの使用することと、ローカルのデータベースのSQLのダンプを使用することです。


### ファイルのアップロード

FTPプログラムを起動して、対象とするサーバーに接続してローカルにインストールしているContaoからファイルをすべてアップロードしてください。


### データベースのエクスポート

もっとも簡単にMySQLのdumpを作成する方法は、データベースの管理ツール"phpMyAdmin"の使用です。サーバーの管理者の場合は、もちろん`mysqldump`ユーティリティも使用できます。"phpMyAdmin"にログインして、エクスポートしたいデータベースを選択して、トップメニューの"エクスポート(Export)"のタブをクリックしてください。MySQLのバージョンの互換性の問題を最小とするため、以下の画面の例のようにエクスポートの設定を調整することが重要です。

![](images/sql-export.jpg?raw=true)


### データベースのインポート

移設先のサーバーに"phpMyAdmin"でログインしてContao用の新しいデータベースを作成します。サーバーの設定によっては、(例えばPleskやcPanelといった)サーバーの管理パネルをデータベースの作成に使用する必要があるでしょう。空のデータベースを選択して、トップメニューの"インポート(Import)"のタブをクリックしてください。それからローカルのデータベースのSQLのダンプをアップロードしてインポートを開始してください

![](images/sql-import.jpg?raw=true)


### データベースの設定の調整

最後に、新しいインストールでContaoのインストールツールを実行して(パスワードはローカルにインストールしていたのと同じはず)、必要な場合はデータベースの設定を調整してください。そしてバックエンドに移動して、あなたのユーザー名とパスワードでログインしてください。


## 稼働中のサーバーの設定

この章はApacheのインストールやPHPのコンパイルといった、共有ホスティングサービスのアカウントではどうにも不可能なことについてではありません。Contaoのシステム要件に合っているかどうかの確認と、PHP 5を有効にする方法を説明します。


### Contaoのシステム要件

+ContaoにはPHPとMySQLをサポートしている、ApacheやIISのようなウェブサーバーが必要です。PHPの最小のバージョンは5.3.2、MySQLの最小のバージョンは5.0です。
また、PHPのGDlib拡張(画像の大きさの変更)、"DOM"(XMLファイル)、SOAP拡張(機能拡張リポジトリ)も必要で、さらにmbstring(マルチバイト文字の処理)とmcrypt(データの暗号化)も追加で必要な場合があります。Contaoはすべての主要なブラウザー、Firefox(バージョン2以降)やInternet Explore(バージョン8以降)で正しく動作するテストをしています。


### Contaoチェック

サーバーがContaoのシステム要件を満たしているかどうかは、Contaoチェックをダウンロードして調べてください。Contaoチェックは機能拡張リポジトリとライブアップデートを利用できるかどうかと、セーフモード対処が必要かどうかを検査します。システムの構成に依存しますが、新しいContaoをインストールツールでインストールのための設定や、既にインストールしているContaoの検証を行えます。

![](images/contao-check.jpg?raw=true)

Zipファイルを展開して、Contaoをインストールしているディレクトリに`check`という名前のフォルダーにアップロードして、それをWebブラウザーで開いてください。

[Contaoチェックをダウンロード][8] | [GitHubのプロジェクトを開く][9]


### ISPに特有の設定

Contaoを動作させるのに少し余分な設定が必要となる、主要なインターネットサービスプロバイダー(ISP)があります。幸い、そのようなISPは例外と言えます。ISPに特有の設定は[Contaoのフォーラム][10]に説明があります。手間のかからないContaoのホスティングを探されている場合は、[Contaoのホスティングパートナー][11]のリストを調べてください。


[1]: https://contao.org/en/download.html
[2]: http://www.winscp.com/
[3]: http://en.wikipedia.org/wiki/Diff
[4]: http://www.inetrobots.com
[5]: http://www.inetrobots.com/shop/product_info.php?info=p12_Live-Update-ID.html
[6]: http://www.inetrobots.com/contact-us.html
[7]: https://contao.org/en/support.html
[8]: https://github.com/contao/check/zipball/master
[9]: https://github.com/contao/check
[10]: https://community.contao.org/en/
[11]: https://contao.org/en/partners.html?search=services&for=partner_hosting
[13]: https://contao.org/en/extension-list/view/music_academy.en.html
[14]: https://contao.org/en/manual/3.3/system-administration.html#extension-catalog
[15]: https://contao.org/en/manual/3.3/system-administration.html#importing-a-template
[15]: https://contao.org/en/manual/3.3/system-administration.html#importing-a-template
